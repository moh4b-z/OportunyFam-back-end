generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
  output   = "../prisma/generated/client"
}

datasource mysql {
  provider = "mysql"
  url      = "mysql://mohammad:M558899m@oportunyfam.mysql.database.azure.com:3306/oportunyfam?sslaccept=strict"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tbl_aulas_atividade {
  id                 Int                  @id @default(autoincrement())
  id_atividade       Int
  data_aula          DateTime             @mysql.Date
  hora_inicio        DateTime             @mysql.Time(0)
  hora_fim           DateTime             @mysql.Time(0)
  vagas_total        Int                  @mysql.UnsignedSmallInt
  vagas_disponiveis  Int                  @mysql.UnsignedSmallInt
  tbl_atividades     tbl_atividade        @relation(fields: [id_atividade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aula_ativ")
  tbl_matricula_aula tbl_matricula_aula[]

  @@index([id_atividade], map: "fk_aula_ativ")
}

model tbl_categoria {
  id            Int             @id @default(autoincrement()) @mysql.UnsignedSmallInt
  nome          String          @unique(map: "nome") @mysql.VarChar(100)
  tbl_atividade tbl_atividade[]
}

model tbl_crianca {
  id                      Int                       @id @default(autoincrement())
  id_sexo                 Int
  id_pessoa               Int                       @unique(map: "id_pessoa")
  tbl_pessoa              tbl_pessoa                @relation(fields: [id_pessoa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_crianca_pessoa")
  tbl_sexo                tbl_sexo                  @relation(fields: [id_sexo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_crianca_sexo")
  tbl_inscricao_atividade tbl_inscricao_atividade[]
  tbl_responsavel         tbl_responsavel[]

  @@index([id_sexo], map: "fk_crianca_sexo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tbl_endereco {
  id                   Int                    @id @default(autoincrement())
  osm_id               BigInt?                @unique(map: "uk_end_osm")
  nome                 String?                @mysql.VarChar(200)
  tipo                 String?                @mysql.VarChar(100)
  cep                  String?                @mysql.VarChar(9)
  logradouro           String?                @mysql.VarChar(200)
  numero               String?                @mysql.VarChar(20)
  complemento          String?                @mysql.VarChar(100)
  bairro               String?                @mysql.VarChar(100)
  cidade               String?                @mysql.VarChar(100)
  estado               String?                @mysql.VarChar(2)
  telefone             String?                @mysql.VarChar(50)
  site                 String?                @mysql.VarChar(255)
  latitude             Decimal                @mysql.Decimal(10, 7)
  longitude            Decimal                @mysql.Decimal(10, 7)
  geo                  Unsupported("point")
  atualizado_em        DateTime               @default(now()) @mysql.Timestamp(0)
  criado_em            DateTime               @default(now()) @mysql.Timestamp(0)
  tbl_instituicao      tbl_instituicao[]
  tbl_usuario_endereco tbl_usuario_endereco[]

  @@index([geo(length: 32)], map: "spx_end_geo")
  @@fulltext([nome, logradouro, bairro, cidade], map: "ft_end")
}

model tbl_instituicao {
  id                               Int                                @id @default(autoincrement())
  cnpj                             String                             @unique(map: "cnpj") @mysql.VarChar(14)
  descricao                        String?                            @mysql.Text
  id_endereco                      Int
  id_pessoa                        Int                                @unique(map: "id_pessoa")
  tbl_atividade                    tbl_atividade[]
  tbl_endereco                     tbl_endereco                       @relation(fields: [id_endereco], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_inst_endereco")
  tbl_pessoa                       tbl_pessoa                         @relation(fields: [id_pessoa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_inst_pessoa")
  tbl_instituicao_tipo_instituicao tbl_instituicao_tipo_instituicao[]
  tbl_publicacao_instituicao       tbl_publicacao_instituicao[]
  tbl_rede_social_instituicao      tbl_rede_social_instituicao[]

  @@index([id_endereco], map: "fk_inst_endereco")
}

model tbl_instituicao_tipo_instituicao {
  id                   Int                  @id @default(autoincrement())
  id_instituicao       Int
  id_tipo_instituicao  Int                  @mysql.UnsignedTinyInt
  tbl_instituicao      tbl_instituicao      @relation(fields: [id_instituicao], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_it_inst")
  tbl_tipo_instituicao tbl_tipo_instituicao @relation(fields: [id_tipo_instituicao], references: [id], onUpdate: NoAction, map: "fk_it_tipo")

  @@unique([id_instituicao, id_tipo_instituicao], map: "uk_inst_tipo")
  @@index([id_tipo_instituicao], map: "fk_it_tipo")
}

model tbl_rede_social {
  id                          Int                           @id @default(autoincrement())
  nome                        String                        @unique(map: "nome") @mysql.VarChar(100)
  icone                       String                        @mysql.VarChar(300)
  tbl_rede_social_instituicao tbl_rede_social_instituicao[]
}

model tbl_rede_social_instituicao {
  id              Int             @id @default(autoincrement())
  link_perfil     String?         @mysql.VarChar(255)
  link_abreviado  String?         @mysql.VarChar(20)
  numero_telefone String?         @mysql.VarChar(20)
  descricao       String?         @mysql.Text
  id_instituicao  Int
  id_rede_social  Int
  tbl_instituicao tbl_instituicao @relation(fields: [id_instituicao], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rsi_inst")
  tbl_rede_social tbl_rede_social @relation(fields: [id_rede_social], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rsi_rede_social")

  @@index([id_instituicao], map: "fk_rsi_inst")
  @@index([id_rede_social], map: "fk_rsi_rede_social")
}

model tbl_responsavel {
  id                      Int                       @id @default(autoincrement())
  criado_em               DateTime                  @default(now()) @mysql.Timestamp(0)
  id_usuario              Int
  id_crianca              Int
  tbl_inscricao_atividade tbl_inscricao_atividade[]
  tbl_crianca             tbl_crianca               @relation(fields: [id_crianca], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_resp_crianca")
  tbl_usuario             tbl_usuario               @relation(fields: [id_usuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_resp_usuario")

  @@unique([id_usuario, id_crianca], map: "uk_resp")
  @@index([id_crianca], map: "fk_resp_crianca")
}

model tbl_sexo {
  id          Int           @id @default(autoincrement())
  nome        String        @unique(map: "nome") @mysql.VarChar(50)
  tbl_crianca tbl_crianca[]
  tbl_usuario tbl_usuario[]
}

model tbl_tipo_instituicao {
  id                               Int                                @id @default(autoincrement()) @mysql.UnsignedTinyInt
  nome                             String                             @unique(map: "nome") @mysql.VarChar(80)
  tbl_instituicao_tipo_instituicao tbl_instituicao_tipo_instituicao[]
}

model tbl_tipo_nivel {
  id          Int           @id @default(autoincrement())
  nivel       String        @unique(map: "nivel") @mysql.VarChar(100)
  tbl_usuario tbl_usuario[]
}

model tbl_usuario {
  id                   Int                    @id @default(autoincrement())
  id_sexo              Int
  id_tipo_nivel        Int
  id_pessoa            Int                    @unique(map: "id_pessoa")
  tbl_responsavel      tbl_responsavel[]
  tbl_pessoa           tbl_pessoa             @relation(fields: [id_pessoa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_usuario_pessoa")
  tbl_sexo             tbl_sexo               @relation(fields: [id_sexo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_sexo")
  tbl_tipo_nivel       tbl_tipo_nivel         @relation(fields: [id_tipo_nivel], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_tipo_nivel")
  tbl_usuario_endereco tbl_usuario_endereco[]

  @@index([id_sexo], map: "fk_usuario_sexo")
  @@index([id_tipo_nivel], map: "fk_usuario_tipo_nivel")
}

model tbl_usuario_endereco {
  id           Int          @id @default(autoincrement())
  descricao    String?      @mysql.VarChar(500)
  id_usuario   Int
  id_endereco  Int
  tbl_endereco tbl_endereco @relation(fields: [id_endereco], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_uend_endereco")
  tbl_usuario  tbl_usuario  @relation(fields: [id_usuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_uend_usuario")

  @@index([id_endereco], map: "fk_uend_endereco")
  @@index([id_usuario], map: "fk_uend_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tbl_atividade {
  id                      Int                       @id @default(autoincrement())
  id_instituicao          Int
  id_categoria            Int                       @mysql.UnsignedSmallInt
  titulo                  String                    @mysql.VarChar(140)
  foto                 String?                @mysql.VarChar(400)
  descricao               String?                   @mysql.Text
  faixa_etaria_min        Int                       @mysql.UnsignedInt
  faixa_etaria_max        Int                       @mysql.UnsignedInt
  gratuita                Boolean                   @default(true)
  preco                   Decimal                   @default(0.00) @mysql.Decimal(10, 2)
  ativo                   Boolean                   @default(true)
  tbl_categoria           tbl_categoria             @relation(fields: [id_categoria], references: [id], onUpdate: NoAction, map: "fk_ativ_cat")
  tbl_instituicao         tbl_instituicao           @relation(fields: [id_instituicao], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ativ_inst")
  tbl_aulas_atividade     tbl_aulas_atividade[]
  tbl_inscricao_atividade tbl_inscricao_atividade[]

  @@index([id_categoria], map: "fk_ativ_cat")
  @@index([id_instituicao], map: "fk_ativ_inst")
  @@fulltext([titulo, descricao], map: "ft_ativ")
}

model tbl_conversa {
  id                  Int                   @id @default(autoincrement())
  criado_em           DateTime              @default(now()) @mysql.Timestamp(0)
  atualizado_em       DateTime?             @mysql.Timestamp(0)
  tbl_mensagem        tbl_mensagem[]
  tbl_pessoa_conversa tbl_pessoa_conversa[]
}

model tbl_inscricao_atividade {
  id                   Int                  @id @default(autoincrement())
  id_crianca           Int
  id_atividade         Int
  id_responsavel       Int?
  id_status            Int                  @mysql.UnsignedTinyInt
  observacao           String?              @mysql.VarChar(300)
  criado_em            DateTime             @default(now()) @mysql.Timestamp(0)
  atualizado_em        DateTime?            @mysql.Timestamp(0)
  tbl_atividade        tbl_atividade        @relation(fields: [id_atividade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_inscativ_ativ")
  tbl_crianca          tbl_crianca          @relation(fields: [id_crianca], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_inscativ_crianca")
  tbl_responsavel      tbl_responsavel?     @relation(fields: [id_responsavel], references: [id], onUpdate: NoAction, map: "fk_inscativ_resp")
  tbl_status_inscricao tbl_status_inscricao? @relation(fields: [id_status], references: [id], onUpdate: NoAction, map: "fk_inscativ_status")
  tbl_matricula_aula   tbl_matricula_aula[]

  @@unique([id_crianca, id_atividade], map: "uk_crianca_atividade")
  @@index([id_atividade], map: "fk_inscativ_ativ")
  @@index([id_responsavel], map: "fk_inscativ_resp")
  @@index([id_status], map: "fk_inscativ_status")
}

model tbl_matricula_aula {
  id                      Int                     @id @default(autoincrement())
  id_inscricao_atividade  Int
  id_aula_atividade       Int
  presente                Boolean                 @default(false)
  nota_observacao         String?                 @mysql.VarChar(500)
  criado_em               DateTime                @default(now()) @mysql.Timestamp(0)
  atualizado_em           DateTime?               @mysql.Timestamp(0)
  tbl_aulas_atividade     tbl_aulas_atividade     @relation(fields: [id_aula_atividade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_matr_aula")
  tbl_inscricao_atividade tbl_inscricao_atividade @relation(fields: [id_inscricao_atividade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_matr_inscricao")

  @@unique([id_inscricao_atividade, id_aula_atividade], map: "uk_matricula_aula")
  @@index([id_aula_atividade], map: "fk_matr_aula")
}

model tbl_mensagem {
  id            Int          @id @default(autoincrement())
  descricao     String       @mysql.Text
  visto         Boolean?     @default(false)
  criado_em     DateTime     @default(now()) @mysql.Timestamp(0)
  atualizado_em DateTime?    @mysql.Timestamp(0)
  id_conversa   Int
  id_pessoa     Int
  tbl_conversa  tbl_conversa @relation(fields: [id_conversa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_conversa_mensagem")
  tbl_pessoa    tbl_pessoa   @relation(fields: [id_pessoa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pessoa_mensagem")

  @@index([id_conversa], map: "fk_conversa_mensagem")
  @@index([id_pessoa], map: "fk_pessoa_mensagem")
}

model tbl_pessoa {
  id                  Int                   @id @default(autoincrement())
  nome                String                @mysql.VarChar(150)
  email               String?               @unique(map: "email") @mysql.VarChar(150)
  senha               String                @mysql.VarChar(256)
  telefone            String?               @mysql.VarChar(16)
  foto_perfil         String?               @mysql.VarChar(400)
  cpf                 String?               @unique(map: "cpf") @mysql.VarChar(11)
  data_nascimento     DateTime?             @mysql.Date
  criado_em           DateTime              @default(now()) @mysql.Timestamp(0)
  atualizado_em       DateTime?             @mysql.Timestamp(0)
  tbl_crianca         tbl_crianca?
  tbl_instituicao     tbl_instituicao?
  tbl_mensagem        tbl_mensagem[]
  tbl_pessoa_conversa tbl_pessoa_conversa[]
  tbl_usuario         tbl_usuario?
}

model tbl_pessoa_conversa {
  id           Int          @id @default(autoincrement())
  id_pessoa    Int
  id_conversa  Int
  tbl_conversa tbl_conversa @relation(fields: [id_conversa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_conversa_pessoa")
  tbl_pessoa   tbl_pessoa   @relation(fields: [id_pessoa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pessoa_conversa")

  @@unique([id_pessoa, id_conversa], map: "uk_pessoa_conversa")
  @@index([id_conversa], map: "fk_conversa_pessoa")
}

model tbl_publicacao_instituicao {
  id              Int             @id @default(autoincrement())
  descricao       String?         @mysql.Text
  imagem     String?         @mysql.VarChar(400)
  criado_em       DateTime        @default(now()) @mysql.Timestamp(0)
  atualizado_em   DateTime?       @mysql.Timestamp(0)
  id_instituicao  Int
  tbl_instituicao tbl_instituicao @relation(fields: [id_instituicao], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_publicacao_inst")

  @@index([id_instituicao], map: "fk_publicacao_inst")
}

model tbl_status_inscricao {
  id                      Int                       @id @default(autoincrement()) @mysql.UnsignedTinyInt
  nome                    String                    @unique(map: "nome") @mysql.VarChar(50)
  tbl_inscricao_atividade tbl_inscricao_atividade[]
}
